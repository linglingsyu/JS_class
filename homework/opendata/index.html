<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>opendata</title>

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4-4.1.1/dt-1.10.21/datatables.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css">
  <script src="jquery-3.5.1.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/v/bs4-4.1.1/dt-1.10.21/datatables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
  <style>
  </style>
</head>

<body class="px-5 mx-5 my-1 d-flex">
  <div class="container w-50">
    <h1 class="text-center mb-3">台灣地區細懸浮微粒資料(PM2.5)</h1>
    <table id="myTable" class="table">
      <thead>
        <th>城市</th>
        <th>地區</th>
        <th>PM2.5</th>
        <th>UpdateTime</th>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
  <div class="w-25"><canvas id="myChart" width="3" height="2"></canvas></div>
</body>

<script>


  let data;
  $.getJSON("https://data.epa.gov.tw/api/v1/aqx_p_02?limit=1000&api_key=9be7b239-557b-4c10-9775-78cadfc555e9&format=json").done(function (res) {
    data = res.records;

    let county = new Array();
    //  console.log(res);
    for (let i = 0; i < data.length; i++) {
      let str = `
        <tr>
          <td>${data[i].county}</td>
          <td>${data[i].Site}</td>
          <td>${data[i].PM25}</td>
          <td>${data[i].DataCreationDate}</td>
        </tr>
        `;
      $("tbody").append(str);
      county.push(data[i].county);
      console.log(county);
    }
    $('#myTable').DataTable();

    let resultC = county.filter(function (element, index, arr) {
      return arr.indexOf(element) === index;
    });
    // console.log(resultC);

    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        datasets: [{
          label: '# of Votes',
          data: [12, 19, 3, 5, 2, 3],
          backgroundColor: [
            'rgba(255, 99, 132)',
            'rgba(54, 162, 235)',
            'rgba(255, 206, 86)',
            'rgba(75, 192, 192)',
            'rgba(153, 102, 255)',
            'rgba(255, 159, 64)'
          ],
          borderColor: [
            'rgba(0, 0, 0, 0)',
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: false
            }
          }]
        }
      }
    });

  }).fail(
    function () {
      console.log("no");
    });
</script>


</html>